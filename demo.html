<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <style>
      /* must use style.scss */
      /* here is sample */
      .selecput {
        z-index: 1;
        position: relative;
        font-size: 13px;
        /* .dim {
            z-index: z-index(dim);
            position: fixed;
            top: 0;
            right: 0;
            bottom: 0;
            left: 0;
            display: none;
            opacity: .3;
            background: #fff;
        } */
      }

      .selecput .i:before {
        z-index: 3;
        position: absolute;
        top: 0;
        left: 0;
        display: none;
        width: 100%;
        height: 100%;
        outline: 1px solid #3e3e3e;
        content: "";
      }

      .selecput .i:after {
        z-index: 4;
        position: absolute;
        top: 0;
        right: 10px;
        bottom: 0;
        width: 5px;
        height: 5px;
        margin: auto;
        border: 1px solid black;
        border-top: 0;
        border-left: 0;
        transform: rotate(45deg);
        transition: transform .4s;
        content: "";
      }

      .selecput .input {
        z-index: 4;
        position: relative;
        display: block;
        overflow: hidden;
        width: 100%;
        padding: 5px 20px 5px 10px;
        font: inherit;
        color: #000;
        text-overflow: ellipsis;
        box-sizing: border-box;
        border: 1px solid black;
        cursor: pointer;
        background: 0;
      }

      .selecput .input:not([readonly])+.i:after {
        transform: rotate(45deg) scaleX(-1);
      }

      .selecput .input:not([readonly]):focus+.i:after {
        animation: cursor .5s alternate infinite;
      }

      .selecput .input:focus+i:before {
        display: block;
      }

      .selecput .input:disabled {
        color: #000;
      }

      .selecput.open {
        z-index: 2;
        /* .dim {
              display: block;
          } */
      }

      .selecput.open .i:after {
        transform: rotate(-45deg) scaleY(-1);
      }

      .selecput.open div {
        display: block;
      }

      .selecput div {
        z-index: 2;
        position: absolute;
        display: none;
        width: 100%;
        color: #000;
        background: #fff;
      }

      .selecput div p {
        margin: -1px 0 0;
        padding: 5px 10px;
        box-sizing: border-box;
        border: 1px solid gray;
        word-break: break-all;
        cursor: pointer;
      }

      .selecput div p[data-placeholder]:before {
        content: attr(data-placeholder) ": ";
      }

      .selecput div p.selected {
        background: #dfdfdf;
      }

      .selecput div p:focus {
        outline: 1px solid #3e3e3e;
      }

      @keyframes cursor {
        0% {
          opacity: 0;
        }
        100% {
          opacity: 1;
        }
      }
    </style>
    <title>selecput demo</title>
</head>
<body>
    <div class="ddd">
      <select name="aaa" id="bbb" class="aaaaa">
        <option value="aaac">sss</option>
        <option value="aaaasdadasdhghhh55555" selected>ss11111s</option>
      </select>
    </div>
    <div class="ddd" style="margin-top: 50px;">
      <select name="aaa" id="bbb2222" class="aaaaa">
        <option value="aaa">sss111</option>
        <option value="adwdwdwadawdaqw" selected>직접입력</option>
        <option value="aaa1">sss11111</option>
        <option value="aaa2">sss111111</option>
        <option value="aaa3">sss11111111</option>
      </select>
    </div>
    <div id="dsaw" style="margin-top: 50px;">
      <select name="aaa" id="aaaaaaaabbb">
        <option value="aaa4">sss</option>
        <option value="5">s1ss</option>
        <option value="aaa545655555555555555" selected>sss</option>
      </select>
    </div>
    <script>
      // must use index.js
      // here is sample
      var selecput = function(el, opt) {
        this.hasClass = function(e, name) {
          var classs = e.getAttribute('class');
          if (classs === null || classs === undefined || classs === ' ') {
            return false;
          }
          if (classs.indexOf(name) === -1) {
            return false;
          } else {
            return true;
          }
        };
        this.addClass = function(e, name) {
          var classs = e.getAttribute('class');
          // console.log(typeof classs);
          if (classs === null || classs === undefined || classs === ' ') {
            e.setAttribute('class', name);
            return false;
          }
          if (classs.indexOf(name) === -1) {
            e.setAttribute('class', classs + ' ' + name);
          }
        };
        this.removeClass = function(e, name) {
          var classs = e.getAttribute('class');
          if (classs === null) {
            return false;
          }
          if (classs.indexOf(name) !== -1) {
            classs = classs.substr(0, classs.indexOf(name) - 1);
            e.setAttribute('class', classs);
          }
        };
        this.toggleClass = function(e, name) {
          var classs = e.getAttribute('class');
          if (classs === null) {
            e.setAttribute('class', name);
            return false;
          }
          if (classs.indexOf(name) === -1) {
            e.setAttribute('class', classs + ' ' + name);
          } else {
            classs = classs.substr(0, classs.indexOf(name) - 1);
            e.setAttribute('class', classs);
          }
        };
        this.repeat = function(fn, i) {
          var num = 0;
          var repeat = function() {
            if (i > 0) {
              i -= 1;
              fn(num);
              num += 1;
              repeat(fn, i);
            } else {
              return false;
            }
          };
          repeat(fn, i);
        };
        this.makeDom = function(i) {
          _this.addClass(ctr.el[i], 'selecput');
          ctr.selecput[i].el = document.createElement('div');
          (ctr.selecput[i].class !== null) && (ctr.selecput[i].el.setAttribute('class', ctr.selecput[i].class));
          (ctr.selecput[i].id !== null) && (ctr.selecput[i].el.setAttribute('id', ctr.selecput[i].id));
          (ctr.selecput[i].name !== null) && (ctr.selecput[i].el.setAttribute('name', ctr.selecput[i].name));

          ctr.selecput[i].input = document.createElement('input');
          if (ctr.selecput[i].value === ctr.editAble) {
            ctr.selecput[i].input.setAttribute('placeholder', ctr.selecput[i].text);
          } else {
            ctr.selecput[i].input.setAttribute('readonly', '');
            ctr.selecput[i].input.setAttribute('value', ctr.selecput[i].text);
          }
          ctr.selecput[i].input.setAttribute('class', ctr.inputClass);
          ctr.selecput[i].input.setAttribute('data-value', ctr.selecput[i].value);

          ctr.selecput[i].i = document.createElement('i');
          ctr.selecput[i].i.setAttribute('class', ctr.iClass);

          //ctr.selecput[i].dim = document.createElement('i');
          //ctr.selecput[i].dim.setAttribute('class', ctr.dimClass);

          function makeOption(j) {
            var _p = document.createElement('p');
            (ctr.selecput[i].option[j].selected !== null) && (_this.addClass(_p, ctr.selectedClass));
            (ctr.selecput[i].option[j].value !== null) && (_p.setAttribute('data-value', ctr.selecput[i].option[j].value));
            (ctr.selecput[i].option[j].value !== null && ctr.selecput[i].option[j].value === ctr.editAble) && (_p.setAttribute('data-placeholder', ctr.selecput[i].option[j].text));
            (ctr.selecput[i].option[j].text !== null) && (_p.innerText = ctr.selecput[i].option[j].text);
            ctr.selecput[i].option[j].el = _p;
            ctr.selecput[i].el.append(_p);
          }
          _this.repeat(makeOption, ctr.selecput[i].option.length);
          ctr.el[i].innerHTML = '';
          ctr.el[i].append(ctr.selecput[i].input);
          ctr.el[i].append(ctr.selecput[i].i);
          ctr.el[i].append(ctr.selecput[i].el);
          //ctr.el[i].append(ctr.selecput[i].dim);
          (ctr.onLoad !== undefined) && (_this.onLoad(ctr.onLoad));
        };
        this.querySelector = function(e, parents) {
          var _e;
          //console.log(parents);
          parents = parents === undefined ? document : parents;
          switch (e[0]) {
            case '.':
              _e = parents.getElementsByClassName(e.substr(1));
              break;
            case '#':
              _e = [];
              _e[0] = parents.getElementById(e.substr(1));
              break;
            default:
              _e = parents.getElementsByTagName(e);
              break;
          }
          return _e;
        };

        this.optionClick = function(i) {
          for (var j = 0; j < ctr.selecput[i].option.length; j++) {
            ctr.selecput[i].el.childNodes[j].onclick = function() {
              _this.value(this, i);
            };
          }
        };
        this.inputClick = function(i) {
          ctr.selecput[i].input.onclick = function() {
            _this.open(i);
          };
        };
        this.inputFocus = function(i) {
          ctr.selecput[i].input.onfocus = function() {
            if (ctr.selecput[i].input.getAttribute('readonly') === null) {
              ctr.selecput[i].sto = setTimeout(function() {
                ctr.el[i].setAttribute('data-focus', true);
              }, 200);
            }
          };
        };
        this.inputBlur = function(i) {
          ctr.selecput[i].input.onblur = function() {
            if (ctr.selecput[i].input.getAttribute('readonly') === null) {
              ctr.el[i].removeAttribute('data-focus');
            }
          };
        };

        this.variables = function(i) {
          var _selected = false;
          var _i;
          var _e = _this.querySelector('select', ctr.el[i])[0];
          var _option = [];

          function makeOption(i) {
            var __option = {
              value: _this.querySelector('option', _e)[i].getAttribute('value'),
              selected: _this.querySelector('option', _e)[i].getAttribute('selected'),
              text: _this.querySelector('option', _e)[i].innerText
            };
            (__option.selected !== null) && (_selected = [__option.value, __option.text]);
            (__option.selected !== null) && (_i = i);
            _option.push(__option);
          }
          _this.repeat(makeOption, _e.length);
          if (!_selected) {
            _selected = [_option[0].value, _option[0].text];
            _i = 0;
          }
          ctr.selecput[i] = {
            activeOption: _this.querySelector('option', _e)[_i],
            value: _selected[0],
            text: _selected[1],
            class: _e.getAttribute('class'),
            id: _e.getAttribute('id'),
            name: _e.getAttribute('name'),
            option: _option
          };
          //console.log(ctr.selecput[i]);
          return ctr;
        };
        this.open = function(i) {
          if (ctr.el[i].getAttribute('data-focus') !== null || ctr.selecput[i].input.getAttribute('readonly') !== null) {
            ctr.selecput[i].active = ctr.el[i];
            if (!_this.hasClass(ctr.el[i], ctr.openClass)) {
              _this.absoluteClose(i);
            }
            _this.toggleClass(ctr.el[i], ctr.openClass);
          }
        };
        this.close = function(i) {
          _this.removeClass(ctr.selecput[i].active, ctr.openClass);
        };
        this.value = function(el, i) {
          //console.log(!_this.hasClass(el, ctr.selectedClass) );
          if (!_this.hasClass(el, ctr.selectedClass)) {
            var _placeholder = el.getAttribute('data-placeholder');
            ctr.selecput[i].value = el.getAttribute('data-value');
            ctr.selecput[i].text = el.innerText;
            ctr.selecput[i].input.setAttribute('data-value', ctr.selecput[i].value);
            if (_placeholder !== null) {
              ctr.selecput[i].input.setAttribute('placeholder', ctr.selecput[i].text);
              ctr.selecput[i].input.removeAttribute('readonly');
              ctr.selecput[i].input.value = '';
              ctr.selecput[i].input.focus();
            } else {
              ctr.selecput[i].input.removeAttribute('placeholder');
              ctr.selecput[i].input.setAttribute('readonly', '');
              ctr.selecput[i].input.value = ctr.selecput[i].text;
            }
            //console.log(_this.querySelector('.'+ctr.selectedClass, ctr.selecput[i].el));
            _this.removeClass(_this.querySelector('.' + ctr.selectedClass, ctr.selecput[i].el)[0], ctr.selectedClass);
            ctr.selecput[i].activeOption = el;
            _this.addClass(el, ctr.selectedClass);
            (ctr.onChange !== undefined) && (_this.onChange(ctr.onChange));
          }
          _this.close(i);
        };
        this.typing = function(i) {
          ctr.selecput[i].input.onchange = function() {
            ctr.selecput[i].text = this.value;
            _this.querySelector('.' + ctr.selectedClass, ctr.selecput[i].el)[0].innerText = ctr.selecput[i].text;
            (ctr.onChange !== undefined) && (_this.onChange(ctr.onChange));
          };
        };
        this.absoluteClose = function(i) {
          if (ctr.absoluteClose === undefined) {
            return false;
          }
          var _remove = function() {
            _this.removeClass(ctr.selecput[i].active, ctr.openClass);
            document.removeEventListener('click', _remove);
          };
          clearTimeout(ctr.absoluteClose);
          ctr.absoluteClose = setTimeout(function(e) {
            document.addEventListener('click', _remove);
          }, 200);
        };
        this.onChange = function(fn) {
          new fn(ctr);
        };
        this.onLoad = function(fn) {
          new fn();
          //return fn;
        };
        this.init = function() {
          ctr = opt === undefined ? {} : opt;
          ctr.el = _this.querySelector(el);
          ctr.lengths = ctr.el.length;
          ctr.selecput = [];
          ctr.openClass = ctr.openClass === undefined ? 'open' : ctr.openClass;
          ctr.selectedClass = ctr.selectedClass === undefined ? 'selected' : ctr.selectedClass;
          ctr.inputClass = ctr.inputClass === undefined ? 'input' : ctr.inputClass;
          ctr.iClass = ctr.iClass === undefined ? 'i' : ctr.iClass;
          ctr.dimClass = ctr.dimClass === undefined ? 'dim' : ctr.dimClass;

          new _this.repeat(_this.variables, ctr.lengths);
          new _this.repeat(_this.makeDom, ctr.lengths);
          new _this.repeat(_this.inputClick, ctr.lengths);
          new _this.repeat(_this.inputFocus, ctr.lengths);
          new _this.repeat(_this.inputBlur, ctr.lengths);
          new _this.repeat(_this.optionClick, ctr.lengths);
          (ctr.editAble !== undefined) && (new _this.repeat(_this.typing, ctr.lengths));
        };
        var _this = this;
        var ctr = {};
        this.init();
      };
    </script>
    <script>
        new selecput('.ddd', {
          editAble: 'adwdwdwadawdaqw',
          onLoad: function() {
            console.log('load complete');
          },
          onChange: function(e) {
            console.log(e);
          },
          absoluteClose: true
        });
        new selecput('#dsaw', {
          onChange: function(e) {
            console.log(e);
          },
          absoluteClose: true
        });
    </script>
</body>
</html>